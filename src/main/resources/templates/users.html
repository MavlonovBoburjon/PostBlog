<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Users</title>
  <link rel="stylesheet" th:href="@{/css/style.css}" />
</head>
<body>
<h2>Users</h2>

<!-- Search form -->
<form method="get" th:action="@{/admin/users}">
  <input type="text" name="q" th:value="${q}" placeholder="Search username..."/>
  <button type="submit">Search</button>
</form>

<div style="text-align:center; margin-bottom:15px;">
  <a th:href="@{/admin/users/new}">Create User</a> |
  <a th:href="@{/posts}">Posts</a>
  <form th:action="@{/logout}" method="post" style="display:inline;">
    <button type="submit" class="btn">Logout</button>
  </form>
</div>

<!-- User table -->
<table>
  <thead>
  <tr>
    <th>Username</th>
    <th>Role</th>
    <th>Created At</th>
    <th>Actions</th>
  </tr>
  </thead>
  <tbody>
  <tr th:each="u : ${usersPage.content}">
    <td th:text="${u.username}"></td>
    <td th:text="${u.role}"></td>
    <td th:text="${u.createdAt != null ? #temporals.format(u.createdAt, 'yyyy-MM-dd HH:mm') : ''}"></td>
    <td>
      <a th:href="@{/admin/users/edit/{id}(id=${u.id})}">Edit</a> |
      <form th:action="@{/admin/users/delete/{id}(id=${u.id})}" method="post" style="display:inline">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <button type="submit">Delete</button>
      </form>
    </td>
  </tr>
  </tbody>
</table>

<!-- Pagination -->
<div style="text-align:center;">
  <span th:text="'Page ' + (${usersPage.number} + 1) + ' of ' + ${usersPage.totalPages}"></span>
  <div th:if="${usersPage.totalPages > 1}">
    <a th:if="${!usersPage.first}" th:href="@{/admin/users(page=${usersPage.number - 1}, size=${usersPage.size}, q=${q})}">Prev</a>
    <span th:each="i : ${#numbers.sequence(0, usersPage.totalPages - 1)}">
      <a th:href="@{/admin/users(page=${i}, size=${usersPage.size}, q=${q})}"
         th:text="${i + 1}"
         th:classappend="${usersPage.number == i} ? 'current'"></a>
    </span>
    <a th:if="${!usersPage.last}" th:href="@{/admin/users(page=${usersPage.number + 1}, size=${usersPage.size}, q=${q})}">Next</a>
  </div>
</div>

<script th:src="@{/js/script.js}"></script>
</body>
</html>
